from sklearn.datasets import fetch_california_housing
import pandas as pd

# Load dataset
data = fetch_california_housing(as_frame=True)

# Full dataframe
df = data.frame

# Features and target
X = df.drop("MedHouseVal", axis=1)
y = df["MedHouseVal"]

# Display shapes
print("Feature matrix shape:", X.shape)
print("Target vector shape:", y.shape)

# Preview data
df.head()

from sklearn.datasets import fetch_california_housing
import pandas as pd

# Load dataset
data = fetch_california_housing(as_frame=True)
df = data.frame

# Features
X = df.drop("MedHouseVal", axis=1)

# Target
y = df["MedHouseVal"]

# Display shapes
print("Shape of features (X):", X.shape)
print("Shape of target (y):", y.shape)


df.head()

df.describe()

missing_values = df.isnull().sum()
print(missing_values)

from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import train_test_split

# 1Ô∏è Standardize features
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)  # Fit on all data and transform

# 2Ô∏è Split dataset into 80% training and 20% testing
X_train, X_test, y_train, y_test = train_test_split(
    X_scaled, y, test_size=0.2, random_state=42
)

# Display shapes to verify
print("X_train shape:", X_train.shape)
print("X_test shape:", X_test.shape)
print("y_train shape:", y_train.shape)
print("y_test shape:", y_test.shape)

from sklearn.decomposition import PCA
import numpy as np

# 1Ô∏è PCA for 95% variance
pca_95 = PCA(n_components=0.95)
pca_95.fit(X_train)

# Number of components for 95% variance
print("Number of components needed for 95% variance:", pca_95.n_components_)

# Transform training and testing datasets using 95% variance PCA
X_train_pca = pca_95.transform(X_train)
X_test_pca = pca_95.transform(X_test)

# Explained variance ratios
print("Explained variance ratios (95% PCA):")
print(np.round(pca_95.explained_variance_ratio_, 4))

# 2Ô∏è PCA for 99% variance
pca_99 = PCA(n_components=0.99)
pca_99.fit(X_train)
print("Number of components needed for 99% variance:", pca_99.n_components_)


from sklearn.linear_model import LinearRegression
from sklearn.metrics import r2_score, mean_absolute_error

# 1Ô∏è Train Linear Regression on PCA-transformed training data
model = LinearRegression()
model.fit(X_train_pca, y_train)

# 2Ô∏è Predict on test set
y_pred = model.predict(X_test_pca)

# Evaluate performance
r2 = r2_score(y_test, y_pred)
mae = mean_absolute_error(y_test, y_pred)

print("R¬≤ Score:", r2)
print("Mean Absolute Error (MAE):", mae)
import streamlit as st
import numpy as np
import joblib

# Load the saved model, scaler, and PCA
model = joblib.load("linear_regression_pca_model.pkl")
scaler = joblib.load("scaler.pkl")
pca = joblib.load("pca_95.pkl")

# Page configuration
st.set_page_config(page_title="California Housing Predictor", layout="centered")

# Title
st.title("üè† California Housing Price Predictor")
st.markdown("Enter the 8 features below to predict the **Median House Value**.")

# Input fields for the 8 features
MedInc = st.number_input("Median Income (10k USD)", value=3.0)
HouseAge = st.number_input("House Age", value=20)
AveRooms = st.number_input("Average Rooms", value=5.0)
AveBedrms = st.number_input("Average Bedrooms", value=1.0)
Population = st.number_input("Population", value=1000)
AveOccup = st.number_input("Average Occupancy", value=3.0)
Latitude = st.number_input("Latitude", value=34.0)
Longitude = st.number_input("Longitude", value=-118.0)

# Button to predict
if st.button("Predict Median House Value"):
    # Prepare input
    input_data = np.array([[MedInc, HouseAge, AveRooms, AveBedrms,
                            Population, AveOccup, Latitude, Longitude]])
    
    # Scale features
    input_scaled = scaler.transform(input_data)
    
    # PCA transform
    input_pca = pca.transform(input_scaled)
    
    # Prediction
    prediction = model.predict(input_pca)
    
    # Display beautifully
    st.markdown("### üí∞ Predicted Median House Value")
    st.markdown(
        f"<div style='background-color:#d1f7c4; padding:20px; border-radius:10px; "
        f"text-align:center; font-size:32px; font-weight:bold;'>"
        f"${prediction[0]*100000:,.2f}</div>",
        unsafe_allow_html=True
    )

st.markdown("---")
st.markdown("Developed with ‚ù§Ô∏è using Python, scikit-learn, PCA & Streamlit")



